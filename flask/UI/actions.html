<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/css/bootstrap.min.css">
    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <link rel="stylesheet" href="css/style.css">

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.0/js/bootstrap.min.js"></script>
    <style></style>
</head>

<body>
    <button onclick="submit()">Submit</button>
    <section id="imgGrid"></section>

    <script>
        var selectedMap = new Map()
        window.onload = function () {
            var data = jQuery.parseJSON(localStorage.getItem('imageDataKey'));

            console.log("in html", data)
            var finalContent = "";
            data.forEach(function (d) {
                var sp = ("<image style=" + "imgcl" + " src=" + d.img + ">"
                    + "<br>" + "<br>"
                    + "<span> " + d.name + " </span>"
                    + "<br>" + "<br>"
                    + "<button id=" + "like_+" + d._id + "  class=" + "button1" + " onclick=\"addValue(\'" + d._id + "'\,\'" + d.cuisine + "'\,\'" + d.img + "'\,1)\">Like</button>"
                    + "<button id=" + "dislike_+" + d._id + " class=" + "button2" + " onclick=\"addValue(\'" + d._id + "'\,\'" + d.cuisine + "'\,\'" + d.img + "'\,0)\">Dislike</button>"
                );
                finalContent = finalContent + sp
            })
            document.getElementById("imgGrid").innerHTML = finalContent;

        }
        function addValue(id,cuisine,imgURL, action) {
            value={"cuisine_id": id, "cuisine": cuisine,"action":action, "image_URL": imgURL}
            var did= id + "_" + cuisine;
                selectedMap.set(did,value)
                console.log(selectedMap)
        }
        function submit(){
            var filteredList = []
            for (let [k, v] of selectedMap) {
                if(v.action==1){
                    filteredList.push(v)
                }
            }
            console.log(filteredList)
            var userName = localStorage.getItem('username')
            var userData = {
                "user_name": userName+123,

                "user_id": "uid123456",

                "favourite_cuisine": {

                    "Indian": 43,

                    "Mexican": 27,

                    "Italian": 30

                },

                "shortterm_favourite_cuisine": {},

                "is_vegan": "False",

                "like_spicy": "True",

                "allergen": ["Tree nut", "Soy"],

                "favourite_restaurant": {

                    "restaurant 1": 26,

                    "restaurant 2": 34,

                    "restaurant 3": 40

                },

                "home_location": "Dublin",

                "current_location": "Dublin",

                "budget": {

                    "weekdays": 15,

                    "weekends": 30

                },
                "user_preferences": filteredList

            }
            /*var url = 'http://127.0.0.1:5000/second-breakfast/save_user_model/';
            fetch(url, {
                method: 'POST', 
                body: JSON.stringify(userData),
                headers: {
                    'Content-Type': 'application/json'
                }
            }).then(res => res.json())
                .then(response => console.log('Success:', JSON.stringify(response)))
                .catch(error => console.error('Error:', error));*/

        }
    </script>
</body>

</html>